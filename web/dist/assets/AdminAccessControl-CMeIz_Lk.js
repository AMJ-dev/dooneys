import{F as se,aN as te,r as o,h as A,a6 as h,j as e,B as p,m as u,N as C,u as ae,v as re,J as j,w as ie,a2 as z}from"./index-DrzvgQSx.js";import{T as le,a as ne,b as B,c as N,d as oe,e as b}from"./table-kDEzH9s1.js";import{C as v,d as y,a as de,b as ce,c as me}from"./card-CSdj4VlM.js";import{P as H}from"./progress-DNf4bHVP.js";import{A as xe,b as he,c as ue,d as fe,e as ge,f as pe,g as je,h as Ne}from"./alert-dialog-DhLhMJxG.js";import{R as be}from"./refresh-cw-B2nHbzn8.js";import{P as $}from"./plus-CdXz1Jo6.js";import{K as ve}from"./key-DLVskWgd.js";import{P as ye}from"./percent-DSP3Ckz8.js";import{U as we}from"./user-check-B5JIGFEE.js";import{E as Ce}from"./eye-DtInb1xn.js";import{S as Re}from"./square-pen-BAbl0GsK.js";import{T as De}from"./trash-2-DF_8SWob.js";const He=()=>{var U,E;const f=se(),{add_role:S,delete_role:w,edit_role:O,view_roles:q}=te(["add_role","delete_role","edit_role","view_roles"]),[i,T]=o.useState([]),[d,K]=o.useState([]),[Q,_]=o.useState(!0),[R,I]=o.useState(""),[J,D]=o.useState(!1),[g,M]=o.useState(null),[P,k]=o.useState(!1);o.useEffect(()=>{if(!q){o.startTransition(()=>f("/unauthorized"));return}F()},[]);const F=async()=>{try{_(!0);const t=(await A.get("/get-permissions/")).data;if(!t.error&&t.data){const m=t.data.map(a=>({id:a.id,name:a.name,description:a.description,permissions:a.permissions||[],staffCount:a.staffCount||0,createdAt:a.createdAt,lastModified:a.lastModified||a.createdAt}));T(m)}else h.error("Failed to load roles");const n=(await A.get("/get-roles/")).data;if(!n.error&&n.data){const m=n.data.map(a=>({id:a.id.toString(),code:a.code,name:a.name,description:a.description,category:a.category}));K(m)}else h.error("Failed to load permissions")}catch(s){console.error("Error fetching data:",s),h.error("Failed to load data")}finally{_(!1)}},x=o.useMemo(()=>{const s=i.length,t=i.reduce((r,c)=>r+c.staffCount,0),l=s>0?i.reduce((r,c)=>r+c.permissions.length,0)/s:0,n=i.length>0?i.reduce((r,c)=>r.staffCount>c.staffCount?r:c):null,m=d.length,a=new Set(i.flatMap(r=>r.permissions)).size,Y=m>0?a/m*100:0,Z=i.map(r=>({name:r.name,count:r.staffCount,percentage:t>0?r.staffCount/t*100:0})).sort((r,c)=>c.count-r.count),ee=[...i].sort((r,c)=>new Date(c.lastModified).getTime()-new Date(r.lastModified).getTime()).slice(0,3);return{totalRoles:s,totalStaff:t,avgPermissions:l.toFixed(1),mostUsedRole:n,coveragePercentage:Y.toFixed(1),staffDistribution:Z,recentlyModified:ee,totalPermissions:d.length,unusedPermissions:m-a}},[i,d]),L=i.filter(s=>s.name.toLowerCase().includes(R.toLowerCase())||s.description.toLowerCase().includes(R.toLowerCase())),G=s=>{if(w){if(s.staffCount>0){h.error("Cannot delete role with assigned staff. Reassign staff first.");return}M(s),D(!0)}},V=async()=>{if(w&&g)try{k(!0);const t=(await A.post("/delete-role/",{id:g.id})).data;t.error?h.error(t.data||"Failed to delete role"):(T(l=>l.filter(n=>n.id!==g.id)),h.success("Role deleted successfully"),o.startTransition(()=>f("/admin/access-control")),D(!1),M(null))}catch(s){console.error("Error deleting role:",s),h.error("Failed to delete role")}finally{k(!1)}},W=s=>{const t=["bg-red-100 text-red-800","bg-purple-100 text-purple-800","bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-orange-100 text-orange-800","bg-cyan-100 text-cyan-800","bg-pink-100 text-pink-800","bg-indigo-100 text-indigo-800"],l=s.split("").reduce((n,m)=>n+m.charCodeAt(0),0)%t.length;return t[l]},X=s=>{const t=d.find(l=>l.code===s);return t?t.name:s};return Q?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading access control data..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-2xl md:text-3xl mb-2",children:"Access Control"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage role-based permissions and access levels"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(p,{variant:"outline",className:"gap-2",onClick:F,children:[e.jsx(be,{className:"h-4 w-4"}),"Refresh"]}),S&&e.jsxs(p,{onClick:()=>f("/admin/access-control/new"),className:"gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Create Role"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(v,{className:"bg-gradient-to-br from-blue-50 to-blue-100/50 border-blue-200",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Total Roles"}),e.jsx("h3",{className:"text-2xl font-bold mt-2",children:x.totalRoles}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[x.totalStaff," staff members assigned"]})]}),e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx(C,{className:"h-5 w-5 text-blue-600"})})]})})})}),e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(v,{className:"bg-gradient-to-br from-green-50 to-green-100/50 border-green-200",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Avg Permissions"}),e.jsx("h3",{className:"text-2xl font-bold mt-2",children:x.avgPermissions}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Per role"})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(ve,{className:"h-5 w-5 text-green-600"})})]})})})}),e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(v,{className:"bg-gradient-to-br from-purple-50 to-purple-100/50 border-purple-200",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Permission Coverage"}),e.jsxs("h3",{className:"text-2xl font-bold mt-2",children:[x.coveragePercentage,"%"]}),e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[x.unusedPermissions," unused permissions"]})]}),e.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:e.jsx(ye,{className:"h-5 w-5 text-purple-600"})})]})})})}),e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsx(v,{className:"bg-gradient-to-br from-orange-50 to-orange-100/50 border-orange-200",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Most Used Role"}),e.jsx("h3",{className:"text-2xl font-bold mt-2",children:((U=x.mostUsedRole)==null?void 0:U.name)||"None"}),e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:[((E=x.mostUsedRole)==null?void 0:E.staffCount)||0," staff"]})]}),e.jsx("div",{className:"p-3 rounded-full bg-orange-100",children:e.jsx(we,{className:"h-5 w-5 text-orange-600"})})]})})})})]}),e.jsxs(v,{children:[e.jsxs(de,{children:[e.jsx(ce,{children:"Staff Distribution"}),e.jsx(me,{children:"Staff members by role"})]}),e.jsx(y,{className:"space-y-4",children:x.staffDistribution.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-primary/60"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.count}),e.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",s.percentage.toFixed(1),"%)"]})]})]}),e.jsx(H,{value:s.percentage,className:"h-1.5 bg-primary/10"})]},s.name))})]}),e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-xl border border-border overflow-hidden",children:[e.jsx("div",{className:"p-5 border-b border-border",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl mb-1",children:"Access Levels Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage all access levels with detailed permissions"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(re,{placeholder:"Search access levels...",value:R,onChange:s=>I(s.target.value),className:"pl-9"})]})})]})}),e.jsx("div",{className:"p-5",children:L.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No access levels found"}),S&&e.jsxs(p,{className:"mt-4",onClick:()=>f("/admin/access-control/new"),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Create New Role"]})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map((s,t)=>e.jsxs(u.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:t*.1},className:"bg-white rounded-xl border border-border p-5 hover:shadow-card-hover transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(C,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]})]}),e.jsxs(j,{className:ie("font-medium",W(s.id)),children:[s.staffCount," staff"]})]}),e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.permissions.length," permissions"]}),d.length>0&&e.jsx(H,{value:s.permissions.length/d.length*100,className:"h-1 w-24"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[s.permissions.slice(0,4).map(l=>{const n=X(l);return e.jsx(j,{variant:"secondary",className:"text-xs",children:n.length>12?n.substring(0,12)+"...":n},l)}),s.permissions.length>4&&e.jsxs(j,{variant:"outline",className:"text-xs",children:["+",s.permissions.length-4," more"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1 gap-1",onClick:()=>o.startTransition(()=>f(`/admin/access-control/${s.id}/${z(s.name)}/details`)),children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),"Details"]}),O&&e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1 gap-1",onClick:()=>f(`/admin/access-control/${s.id}/${z(s.name)}`),children:[e.jsx(Re,{className:"h-3.5 w-3.5"}),"Edit"]}),w&&e.jsx(p,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>G(s),children:e.jsx(De,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mt-4 pt-4 border-t border-border",children:[e.jsxs("span",{children:["Created: ",new Date(s.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),e.jsxs("span",{children:["Modified: ",new Date(s.lastModified).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]})]},s.id))})})]}),d.length>0&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-card rounded-xl border border-border overflow-hidden",children:[e.jsx("div",{className:"p-5 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl mb-1",children:"Permissions Reference"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Complete list of all available permissions across ",Array.from(new Set(d.map(s=>s.category))).length," categories"]})]}),e.jsxs(j,{variant:"outline",children:[d.length," Permissions"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(B,{children:[e.jsx(N,{children:"Permission"}),e.jsx(N,{children:"Code"}),e.jsx(N,{children:"Category"}),e.jsx(N,{children:"Description"}),e.jsx(N,{className:"text-center",children:"Assigned Roles"})]})}),e.jsx(oe,{children:d.map(s=>{const t=i.filter(l=>l.permissions.includes(s.code)).length;return e.jsxs(B,{className:"hover:bg-muted/50",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(b,{children:e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.code})}),e.jsx(b,{children:e.jsx(j,{variant:"outline",children:s.category})}),e.jsx(b,{className:"text-muted-foreground",children:s.description}),e.jsxs(b,{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:t}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i.length>0?(t/i.length*100).toFixed(0)+"% of roles":"No roles"})]})]},s.id)})})]})})]}),w&&e.jsx(xe,{open:J,onOpenChange:D,children:e.jsxs(he,{children:[e.jsxs(ue,{children:[e.jsx(fe,{children:"Delete Role"}),e.jsxs(ge,{children:['Are you sure you want to delete the role "',g==null?void 0:g.name,'"? This action cannot be undone.']})]}),e.jsxs(pe,{children:[e.jsx(je,{disabled:P,children:"Cancel"}),e.jsx(Ne,{onClick:V,disabled:P,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:P?"Deleting...":"Delete Role"})]})]})})]})};export{He as default};
