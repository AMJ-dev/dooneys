import{F as be,aN as ye,r as m,h as y,a6 as d,j as e,m as x,B as E,H as we,g as Se,y as _e,aG as T,aH as F,d as $,aI as U,u as Ce,v as De,at as Ae,au as Te,av as Fe,ax as $e,ay as L,J as z}from"./index-DrzvgQSx.js";import{T as Ue,a as Le,b as J,c as j,d as Me,e as p}from"./table-kDEzH9s1.js";import{A as Q,a as Re,b as Y,c as q,d as G,e as K,f as W,g as X,h as Z}from"./alert-dialog-DhLhMJxG.js";import{S as Be,a as Ie,b as Oe,c as ke,d as M}from"./select-CeCrIOLN.js";import{C as g,d as f,a as ee,b as se,c as te}from"./card-CSdj4VlM.js";import{P as b}from"./progress-DNf4bHVP.js";import{R as He}from"./refresh-cw-B2nHbzn8.js";import{U as ae}from"./users-BACZCDYD.js";import{D as Pe}from"./dollar-sign-CiHtqMiF.js";import{E as Ve}from"./ellipsis-CiWrXJQx.js";import{L as R}from"./loader-circle-oXQTLidO.js";import{B as re}from"./ban-CoTCs6VJ.js";import{C as ne}from"./circle-check-big-Cc93Cm_Q.js";import{A as le}from"./arrow-right-left-CFdBtpqk.js";import{T as Ee}from"./trash-2-DF_8SWob.js";import"./index-BdQq_4o_.js";import"./index-DDpYfoMH.js";import"./chevron-up-DEDQgLDp.js";const cs=()=>{const ie=be(),{view_customers:ce,delete_customer:B,convert_to_staff:w,activate_deactivate_customer:I}=ye(["view_customers","delete_customer","convert_to_staff","activate_deactivate_customer"]),[S,de]=m.useState(""),[_,oe]=m.useState("all"),[c,me]=m.useState([]),[xe,O]=m.useState(!1),[h,u]=m.useState(null),[l,C]=m.useState(null),[he,D]=m.useState(!1);m.useEffect(()=>{if(!ce){m.startTransition(()=>ie("/unauthorized"));return}v()},[]);const v=async()=>{O(!0);try{const t=(await y.get("/get-customers/")).data;if(!t.error&&t.data){me(t.data);return}d.error(t.data||"Failed to load customers")}catch{d.error("Failed to load customers")}finally{O(!1)}},a=m.useMemo(()=>{const s=c.length,t=c.filter(n=>n.status==="active").length,i=c.reduce((n,o)=>n+parseFloat(o.total_spent||"0"),0),r=c.reduce((n,o)=>n+o.total_orders,0),P=s>0?r/s:0,N=c.filter(n=>{const o=new Date(n.joined_date),V=new Date;return o.getMonth()===V.getMonth()&&o.getFullYear()===V.getFullYear()}).length,ge=c.filter(n=>parseFloat(n.total_spent||"0")>1e3).length,fe=c.filter(n=>n.total_orders>10).length,ve=[...c].sort((n,o)=>parseFloat(o.total_spent||"0")-parseFloat(n.total_spent||"0")).slice(0,5),Ne=[...c].sort((n,o)=>new Date(o.joined_date).getTime()-new Date(n.joined_date).getTime()).slice(0,5);return{totalUsers:s,activeUsers:t,totalRevenue:i,totalOrders:r,avgOrdersPerUser:P,newUsersThisMonth:N,highValueUsers:ge,frequentBuyers:fe,topSpendingCustomers:ve,recentSignups:Ne}},[c]),k=c.filter(s=>{const i=`${s.first_name} ${s.last_name}`.toLowerCase().includes(S.toLowerCase())||s.email.toLowerCase().includes(S.toLowerCase()),r=_==="all"||s.status===_;return i&&r}),ue=async()=>{if(w&&l)try{u(`convert-${l.id}`);const t=(await y.post("/convert-to-staff/",{id:String(l.id)})).data;if(!t.error&&t.data){d.success(`${l.first_name} has been converted to staff account`),D(!1),C(null),v();return}d.error(t.error||"Failed to convert customer to staff")}catch{d.error("Failed to convert customer to staff")}finally{u(null)}},je=async(s,t)=>{if(B)try{u(`delete-${s}`);const r=(await y.post("/delete-user/",{id:s})).data;if(!r.error&&r.data){d.success(`${t}'s account has been deleted`),v();return}d.error(r.data||"Failed to delete user account")}catch{d.error("Failed to delete user account")}finally{u(null)}},pe=async(s,t,i)=>{if(I)try{u(`status-${s}`);const r=t==="active"?"2":"1",N=(await y.post("/update-user-status/",{id:s,status:r})).data;if(!N.error&&N.data){d.success(`${i} has been ${r==="1"?"activated":"suspended"}`),v();return}d.error(N.data||"Failed to update user status")}catch{d.error("Failed to update user status")}finally{u(null)}},H=s=>s==="active"?e.jsxs(z,{className:"bg-green-100 text-green-800 border-0",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"Active"]}):e.jsxs(z,{className:"bg-gray-100 text-gray-800 border-0",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Inactive"]}),A=(s,t)=>`${s[0]}${t[0]}`.toUpperCase();return xe?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center bg-gradient-warm",children:e.jsxs(x.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-6",children:[e.jsxs("div",{className:"relative mx-auto w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-primary/10"}),e.jsx(x.div,{animate:{rotate:360},transition:{duration:1.5,repeat:1/0,ease:"linear"},className:"absolute inset-0 rounded-full border-4 border-primary border-t-transparent"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Loading customer information"}),e.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Please wait a moment..."})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-2xl md:text-3xl mb-2",children:"Customers Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer accounts and view analytics"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(E,{variant:"outline",className:"gap-2",onClick:v,children:[e.jsx(He,{className:"h-4 w-4"}),"Refresh"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(g,{className:"bg-gradient-to-br from-blue-50 to-blue-100/50 border-blue-200",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Total Customers"}),e.jsx("h3",{className:"text-2xl font-bold mt-2",children:a.totalUsers})]}),e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx(ae,{className:"h-5 w-5 text-blue-600"})})]}),e.jsx(b,{value:a.totalUsers>0?a.activeUsers/a.totalUsers*100:0,className:"h-1 mt-4 bg-blue-200"})]})})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(g,{className:"bg-gradient-to-br from-green-50 to-green-100/50 border-green-200",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Total Revenue"}),e.jsx("h3",{className:"text-2xl font-bold mt-2",children:we(a.totalRevenue)})]}),e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx(Pe,{className:"h-5 w-5 text-green-600"})})]}),e.jsx(b,{value:75,className:"h-1 mt-4 bg-green-200"})]})})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(g,{className:"bg-gradient-to-br from-purple-50 to-purple-100/50 border-purple-200",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Total Orders"}),e.jsx("h3",{className:"text-2xl font-bold mt-2",children:a.totalOrders})]}),e.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:e.jsx(Se,{className:"h-5 w-5 text-purple-600"})})]}),e.jsx(b,{value:Math.min(a.totalOrders,100),className:"h-1 mt-4 bg-purple-200"})]})})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsx(g,{className:"bg-gradient-to-br from-orange-50 to-orange-100/50 border-orange-200",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"High Value Customers"}),e.jsx("h3",{className:"text-2xl font-bold mt-2",children:a.highValueUsers})]}),e.jsx("div",{className:"p-3 rounded-full bg-orange-100",children:e.jsx(_e,{className:"h-5 w-5 text-orange-600"})})]}),e.jsx(b,{value:a.totalUsers>0?a.highValueUsers/a.totalUsers*100:0,className:"h-1 mt-4 bg-orange-200"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(g,{className:"lg:col-span-2",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Top Spending Customers"}),e.jsx(te,{children:"Highest revenue generating customers"})]}),e.jsx(f,{children:a.topSpendingCustomers.length>0?e.jsx("div",{className:"space-y-4",children:a.topSpendingCustomers.map((s,t)=>{const i=parseFloat(s.total_spent||"0"),r=a.totalRevenue>0?i/a.totalRevenue*100:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold",children:t+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{className:"w-10 h-10",children:[e.jsx(F,{src:$(s.pics)}),e.jsx(U,{className:"bg-primary/10 text-primary",children:A(s.first_name,s.last_name)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["$",i.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.total_orders," orders"]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(b,{value:r,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 text-right",children:[r.toFixed(1),"%"]})]})]},s.id)})}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No customer spending data available"})})})]}),e.jsxs(g,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Recent Signups"}),e.jsx(te,{children:"New customers registered this month"})]}),e.jsx(f,{className:"space-y-4",children:a.recentSignups.length>0?a.recentSignups.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted/50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(T,{className:"w-8 h-8",children:[e.jsx(F,{src:$(s.pics)}),e.jsx(U,{className:"bg-primary/10 text-primary text-xs",children:A(s.first_name,s.last_name)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.joined_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),H(s.status)]})]},s.id)):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent signups"})})})]})]}),e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-xl border border-border overflow-hidden",children:[e.jsx("div",{className:"p-5 border-b border-border",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl mb-1",children:"Customers Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detailed view of all customers with advanced filtering"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(De,{placeholder:"Search customers by name or email...",value:S,onChange:s=>de(s.target.value),className:"pl-9"})]}),e.jsxs(Be,{value:_,onValueChange:oe,children:[e.jsx(Ie,{className:"w-[120px]",children:e.jsx(Oe,{placeholder:"Status"})}),e.jsxs(ke,{children:[e.jsx(M,{value:"all",children:"All Status"}),e.jsx(M,{value:"active",children:"Active"}),e.jsx(M,{value:"inactive",children:"Inactive"})]})]})]})})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ue,{children:[e.jsx(Le,{children:e.jsxs(J,{children:[e.jsx(j,{children:"Customer"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"text-center",children:"Joined"}),e.jsx(j,{className:"text-center",children:"Orders"}),e.jsx(j,{className:"text-center",children:"Total Spent"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(Me,{children:k.map(s=>{const t=parseFloat(s.total_spent||"0");return e.jsxs(J,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(T,{className:"w-10 h-10",children:[e.jsx(F,{src:$(s.pics)}),e.jsx(U,{className:"bg-primary/10 text-primary",children:A(s.first_name,s.last_name)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx(p,{children:H(s.status)}),e.jsxs(p,{className:"text-center",children:[e.jsx("div",{className:"text-sm",children:new Date(s.joined_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.joined_date).toLocaleDateString("en-US",{year:"numeric"})})]}),e.jsx(p,{className:"text-center font-medium",children:s.total_orders}),e.jsxs(p,{className:"text-center font-medium",children:["$",t.toLocaleString()]}),e.jsx(p,{className:"text-right",children:e.jsxs(Ae,{children:[e.jsx(Te,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(Ve,{className:"h-4 w-4"})})}),e.jsxs(Fe,{align:"end",children:[I&&e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsxs(L,{className:"text-amber-600",onClick:()=>pe(String(s.id),s.status,`${s.first_name} ${s.last_name}`),disabled:h===`status-${s.id}`,children:[h===`status-${s.id}`?e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}):s.status==="active"?e.jsx(re,{className:"h-4 w-4 mr-2"}):e.jsx(ne,{className:"h-4 w-4 mr-2"}),s.status==="active"?"Suspend Customer":"Activate Customer"]})]}),w&&e.jsxs(L,{className:"text-indigo-600",onClick:()=>{C(s),D(!0)},children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Convert to Staff"]}),B&&e.jsxs(Q,{children:[e.jsx(Re,{asChild:!0,children:e.jsxs(L,{className:"text-rose-600",onSelect:i=>i.preventDefault(),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Delete Account"]})}),e.jsxs(Y,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Delete Customer Account"}),e.jsxs(K,{children:["Are you sure you want to delete ",s.first_name,"'s account? This action cannot be undone."]})]}),e.jsxs(W,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(Z,{onClick:()=>je(String(s.id),`${s.first_name} ${s.last_name}`),className:"bg-rose-600 hover:bg-rose-700",disabled:h===`delete-${s.id}`,children:h===`delete-${s.id}`?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Account"})]})]})]})]})]})})]},s.id)})})]})}),k.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No customers found"})]})]}),w&&e.jsx(Q,{open:he,onOpenChange:D,children:e.jsxs(Y,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),"Convert to Staff Account"]}),e.jsx(K,{children:l&&e.jsxs(e.Fragment,{children:["Convert ",e.jsxs("span",{className:"font-semibold",children:[l.first_name," ",l.last_name]})," from a customer account to a staff account? This will grant them administrative access."]})})]}),e.jsxs(W,{children:[e.jsx(X,{onClick:()=>C(null),children:"Cancel"}),e.jsx(Z,{onClick:ue,disabled:!l||h===`convert-${l==null?void 0:l.id}`,className:"bg-primary hover:bg-primary",children:h===`convert-${l==null?void 0:l.id}`?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}),"Converting..."]}):"Convert to Staff"})]})]})})]})};export{cs as default};
