import{p as X,r,as as ee,F as te,U as se,j as e,ap as ae,o as re,m as o,an as ie,M as ne,v as oe,w as z,D as S,B as D,A as ce,N as le,C as me,f as de,h as O,a6 as b}from"./index-DrzvgQSx.js";import{C as xe,a as pe,b as ue,c as fe,d as he,e as ge}from"./card-CSdj4VlM.js";import{S as ye}from"./separator-DpYAwveS.js";import{F as be}from"./fingerprint-DTiD5Nld.js";import{S as we}from"./smartphone-DwZ_sJ1F.js";import{C as je}from"./circle-alert-D5MbGcH3.js";import{C as ve}from"./clock-B9_Mht4K.js";import{L as V}from"./loader-circle-oXQTLidO.js";import{R as Ne}from"./refresh-cw-B2nHbzn8.js";import{C as ke}from"./circle-check-big-Cc93Cm_Q.js";import{L as Se}from"./lock-DWWiw9OW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=X("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Ie=()=>r.useMemo(()=>{const i=navigator.userAgent;let l="Unknown Browser";i.includes("Chrome")&&!i.includes("Edg")?l="Chrome":i.includes("Firefox")?l="Firefox":i.includes("Safari")&&!i.includes("Chrome")?l="Safari":i.includes("Edg")&&(l="Edge");let c="Unknown OS";i.includes("Windows")?c="Windows":i.includes("Mac")?c="Mac OS":i.includes("Linux")?c="Linux":i.includes("Android")?c="Android":i.includes("iOS")&&(c="iOS");let x="Desktop";return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(i)?x="Mobile":/Tablet|iPad/i.test(i)&&(x="Tablet"),{deviceType:x,browser:l,os:c,userAgent:i}},[]),Le=()=>{const[i,l]=r.useState(null),[c,x]=r.useState(!0),[C,p]=r.useState(null);return r.useEffect(()=>{(async()=>{try{const m=await(await fetch("https://ipapi.co/json/")).json();l({ip:m.ip,country:m.country_name,region:m.region,city:m.city,timezone:m.timezone,isp:m.org})}catch(I){console.error("Failed to fetch location info:",I),p("Unable to retrieve location information");try{const L=await(await fetch("https://api.ipify.org?format=json")).json();l({ip:L.ip,country:"Unknown",region:"Unknown",city:"Unknown",timezone:"Unknown",isp:"Unknown"})}catch{l({ip:"Unknown",country:"Unknown",region:"Unknown",city:"Unknown",timezone:"Unknown",isp:"Unknown"})}}finally{x(!1)}})()},[]),{locationInfo:i,loading:c,error:C}},d=6,Oe=({role:i})=>{const[l]=ee();l.get("redirect");const c=te(),x=r.useContext(se);if(!x)throw new Error("useAuth must be used within an AuthProvider");const{login:C}=x,p=Ie(),{locationInfo:h,loading:I}=Le(),[m,L]=r.useState(""),[W,_]=r.useState(""),[g,w]=r.useState(Array(d).fill("")),j=r.useRef([]),[T,R]=r.useState(!1),[v,E]=r.useState(60),[y,N]=r.useState(!1),[H,Te]=r.useState(!1),[U,P]=r.useState(!1),[$,f]=r.useState(""),k=s=>{var t;(t=j.current[s])==null||t.focus()};r.useEffect(()=>{const s=sessionStorage.getItem("jwt"),t=sessionStorage.getItem("email");if(sessionStorage.getItem("redirect"),!s||!t){r.startTransition(()=>c("/login"));return}L(s),_(t);const a=sessionStorage.getItem("otpCountdown");if(a){const n=parseInt(a,10);n>0?(E(n),N(!1)):N(!0)}setTimeout(()=>{var n;(n=j.current[0])==null||n.focus()},300)},[]),r.useEffect(()=>{if(!y&&v>0){const s=setTimeout(()=>{E(t=>{const a=t-1;return sessionStorage.setItem("otpCountdown",a.toString()),a})},1e3);return()=>clearTimeout(s)}!y&&v===0&&(N(!0),sessionStorage.removeItem("otpCountdown"))},[v,y]);const F=()=>`${p.browser} on ${p.os} (${p.deviceType})`,B=()=>h?`${h.city}, ${h.region}, ${h.country}`:"Location information not available",J=s=>{const t=Math.floor(s/60),a=s%60;return`${t}:${a<10?"0":""}${a}`},K=(s,t)=>{if(!/^\d?$/.test(s))return;const a=[...g];a[t]=s,w(a),f(""),s&&t<d-1&&setTimeout(()=>k(t+1),10)},G=(s,t)=>{if(s.key==="Backspace")if(!g[t]&&t>0)k(t-1);else{const a=[...g];a[t]="",w(a)}else s.key==="ArrowLeft"&&t>0?k(t-1):s.key==="ArrowRight"&&t<d-1&&k(t+1)},Y=s=>{s.preventDefault();const t=s.clipboardData.getData("text").replace(/\D/g,"").slice(0,d);if(!t)return;const a=t.split("").concat(Array(d).fill("")).slice(0,d);w(a),f("")},Z=async()=>{var s,t;if(y){R(!0);try{const n=(await O.post("/resend-otp/",{jwt:m})).data;if((n==null?void 0:n.error)===!1&&(n!=null&&n.data)){b.success("New verification code sent to your email"),E(60),N(!1),w(Array(d).fill("")),f(""),sessionStorage.setItem("otpCountdown","60"),setTimeout(()=>{var u;(u=j.current[0])==null||u.focus()},100);return}b.error(n.data||"Failed to resend code")}catch(a){console.error(a),b.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to resend code")}finally{R(!1)}}},q=async()=>{var t,a,n;const s=g.join("");if(console.log(s.length+1,d),s.length!==d){f("Please enter all 6 digits");return}P(!0),f("");try{const u=sessionStorage.getItem("email");if(!u){b.error("Session expired. Please login again."),c("/login");return}const A=(await O.post("/verify-otp/",{email:u,otp:s,jwt:m,device_info:F(),location_info:B(),device_type:p.deviceType,platform:p.os,browser:p.browser})).data;if(A.error){f(A.data||"Invalid verification code");return}b.success("Identity verified successfully!"),C({token:(t=A.code)==null?void 0:t.jwt,remember:!0});const Q=sessionStorage.getItem("redirect")||`/${i}`;sessionStorage.removeItem("redirect"),sessionStorage.removeItem("otpCountdown"),setTimeout(()=>location.href=Q,2e3)}catch(u){console.error(u);const M=((n=(a=u.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to verify code";f(M),b.error(M)}finally{P(!1)}};return H?e.jsx(ae,{}):e.jsx(re,{children:e.jsxs("section",{className:"min-h-screen flex items-center justify-center px-4 py-6 bg-gradient-to-br from-background via-background to-primary/5",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((s,t)=>e.jsx(o.div,{className:"absolute rounded-full bg-gradient-to-r from-primary/10 to-accent/10",style:{width:`${Math.random()*80+40}px`,height:`${Math.random()*80+40}px`,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{y:[0,-30,0],x:[0,Math.random()*20-10,0]},transition:{duration:Math.random()*10+10,repeat:1/0,ease:"easeInOut"}},t))}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md mx-auto",children:[e.jsx(o.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex items-center justify-center mb-6 px-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary/10 to-accent/10 backdrop-blur-sm rounded-full border border-primary/20",children:[e.jsx(ie,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Secure Identity Verification"})]})}),e.jsxs(xe,{className:"relative bg-gradient-to-b from-card/95 to-card/70 backdrop-blur-sm border-border/50 shadow-2xl rounded-2xl sm:rounded-3xl overflow-hidden mx-1 sm:mx-0",children:[e.jsx("div",{className:"absolute -inset-1 sm:-inset-2 bg-gradient-to-r from-primary/20 via-accent/20 to-transparent rounded-2xl sm:rounded-3xl blur-xl opacity-20"}),e.jsxs(pe,{className:"text-center pb-4 sm:pb-6 relative z-10 px-4 sm:px-6 pt-6 sm:pt-8",children:[e.jsx(o.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.3},className:"mx-auto mb-4",children:e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-r from-primary to-accent rounded-xl sm:rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(be,{className:"h-8 w-8 sm:h-10 sm:w-10 text-primary-foreground"})})}),e.jsx(ue,{className:"font-display text-2xl sm:text-3xl md:text-4xl mb-2",children:"Verify Your Identity"}),e.jsxs(fe,{className:"text-base sm:text-lg break-words px-2",children:["Enter the 6-digit code sent to"," ",e.jsx("span",{className:"font-semibold text-primary break-all",children:W})]})]}),e.jsxs(he,{className:"pb-4 sm:pb-6 relative z-10 px-4 sm:px-6",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 p-3 sm:p-4 bg-gradient-to-r from-muted/20 to-muted/10 rounded-xl sm:rounded-2xl border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsx(we,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),e.jsx("span",{className:"font-medium text-sm sm:text-base",children:"Device Information"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words",children:F()}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mt-2 sm:mt-3",children:[e.jsx(ne,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),e.jsx("span",{className:"font-medium text-sm sm:text-base",children:"Location"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words",children:B()})]})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm sm:text-base font-medium block mb-3 sm:mb-4 text-center",children:"Enter 6-digit verification code"}),e.jsx("div",{className:"flex justify-center gap-2 sm:gap-3 mb-4",onPaste:Y,children:g.map((s,t)=>e.jsx(o.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex-shrink-0",children:e.jsx(oe,{ref:a=>j.current[t]=a,value:s,inputMode:"numeric",maxLength:1,autoFocus:t===0,onChange:a=>K(a.target.value,t),onKeyDown:a=>G(a,t),className:z("h-12 w-12 sm:h-14 sm:w-14 md:h-16 md:w-16","text-center text-xl sm:text-2xl md:text-3xl font-bold","border-2 bg-background/70 backdrop-blur-sm","focus:border-primary focus:ring-2 focus:ring-primary/20","transition-all duration-200 rounded-xl sm:rounded-2xl",s&&"border-primary/50 bg-primary/5 shadow-inner","px-0"),style:{minWidth:"0",maxWidth:"100%"}})},t))}),e.jsx(S,{children:$&&e.jsxs(o.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-start gap-2 px-3 py-2 sm:px-4 sm:py-3 bg-destructive/10 border border-destructive/20 rounded-lg sm:rounded-xl mb-3 sm:mb-4",children:[e.jsx(je,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs sm:text-sm text-destructive leading-tight",children:$})]})})]}),e.jsx("div",{className:"text-center",children:e.jsx(S,{mode:"wait",children:y?e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"text-sm text-muted-foreground",children:[e.jsx("p",{className:"mb-2",children:"Didn't receive the code?"}),e.jsxs(D,{onClick:Z,variant:"outline",size:"sm",disabled:!y||T,className:"gap-2 border-primary/30 hover:border-primary hover:bg-primary/5 text-xs sm:text-sm px-3 sm:px-4",children:[e.jsx(S,{mode:"wait",children:T?e.jsx(o.span,{initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},exit:{opacity:0,rotate:180},children:e.jsx(V,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"})},"loading"):e.jsx(o.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(Ne,{className:"h-3 w-3 sm:h-4 sm:w-4"})},"icon")}),T?"Sending...":"Resend Code"]})]},"resend"):e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"inline-flex items-center gap-2 sm:gap-3 px-3 sm:px-5 py-2 sm:py-3 rounded-lg sm:rounded-xl bg-gradient-to-r from-primary/10 to-accent/10 border border-primary/20",children:[e.jsx(ve,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary animate-pulse"}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-primary",children:["Resend code in ",J(v)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Check your email for the code"})]})]},"countdown")})}),e.jsx(D,{onClick:q,disabled:g.join("").length!==d||U,className:z("w-full h-12 sm:h-14 text-sm sm:text-base font-medium rounded-lg sm:rounded-xl","bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90","shadow-lg hover:shadow-xl transition-all duration-300","disabled:opacity-50 disabled:cursor-not-allowed","group mt-4"),children:e.jsx(S,{mode:"wait",children:U?e.jsxs(o.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(V,{className:"h-4 w-4 sm:h-5 sm:w-5 animate-spin"}),"Verifying..."]},"verifying"):e.jsxs(o.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center gap-2 sm:gap-3",children:["Verify & Continue",e.jsx(ce,{className:"h-4 w-4 sm:h-5 sm:w-5 transition-transform group-hover:translate-x-1"})]},"default")})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground mt-3",children:[e.jsx(ke,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"text-center",children:"Will auto-submit when all digits are entered"})]})]}),e.jsx(ye,{className:"my-4 sm:my-6"}),e.jsxs("div",{className:"p-3 sm:p-4 bg-gradient-to-r from-muted/20 to-muted/10 rounded-xl sm:rounded-2xl border border-border/50",children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(le,{className:"h-4 w-4 text-primary"}),"Security Notice"]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground leading-relaxed",children:"This code expires in 10 minutes. Never share your verification code with anyone. Doonneys Beauty will never ask for this code."})]})]}),e.jsx(ge,{className:"border-t border-border/50 pt-4 sm:pt-6 relative z-10 px-4 sm:px-6 pb-6",children:e.jsxs("div",{className:"w-full text-center",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>c("/login"),className:"gap-2 text-muted-foreground hover:text-foreground text-xs sm:text-sm px-3",children:[e.jsx(me,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Back to login"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Need help? Contact"," ",e.jsx("a",{href:"mailto:support@doonneysbeauty.com",className:"text-primary hover:underline break-words",children:"support@doonneysbeauty.com"})]})]})})]}),e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-4 sm:mt-6 flex items-center justify-center px-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-card/80 backdrop-blur-sm rounded-full border border-border/50 shadow-lg max-w-full",children:[e.jsx(Se,{className:"h-3 w-3 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium truncate",children:"256-bit SSL â€¢ Encrypted Connection"})]})}),e.jsx("div",{className:"mt-4 sm:hidden",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-3 w-3 text-primary"}),e.jsx("span",{children:"Tip: Tap and hold to paste code"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-3 w-3 text-primary"}),e.jsx("span",{children:"Code will auto-submit when complete"})]})]})})]})]})})};export{Oe as V};
