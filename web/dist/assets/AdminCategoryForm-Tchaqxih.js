import{aN as oe,E as de,as as le,F as me,r as x,h as z,d as ge,a6 as d,j as e,B as m,v as S,t as O,X as ue}from"./index-DrzvgQSx.js";import{C as F,a as E,b as P,c as T,d as U}from"./card-CSdj4VlM.js";import{L as p}from"./label-D6nqg-AK.js";import{T as he}from"./textarea-svmRLyU5.js";import{S as V}from"./switch-BNZbPRLI.js";import{A as J}from"./arrow-left-4JsjAwAx.js";import{S as M}from"./save-BctxvPZE.js";import{P as xe}from"./pen-DBLRQO7X.js";import{P as H}from"./plus-CdXz1Jo6.js";import{G as pe}from"./grip-vertical-B2cdzEI0.js";import{C as fe}from"./chevron-up-DEDQgLDp.js";import{T as K}from"./trash-2-DF_8SWob.js";import{U as Q}from"./upload-DzFS-i39.js";import{E as je}from"./eye-DtInb1xn.js";import"./index-DDpYfoMH.js";const _e=()=>{const{add_category:W,edit_category:X}=oe(["add_category","edit_category"]),{id:b,name:k}=de(),[Y]=le(),h=me(),c=!!b,f=Y.get("view")==="true",i=f,[r,g]=x.useState({id:"",name:"",slug:"",description:"",image:"",status:"active",subCategories:[]}),[C,j]=x.useState(!1),[y,A]=x.useState(null),[w,$]=x.useState(""),[L,R]=x.useState(new Set);x.useEffect(()=>{if(c){if(!X){x.startTransition(()=>h("/unauthorized"));return}j(!0),Z()}else if(!W){x.startTransition(()=>h("/unauthorized"));return}},[b,c]);const Z=async()=>{var a;try{const s=(await z.get(`/get-category/${b}/`)).data;if(s.error==!1&&s.data){g({id:s.data.id.toString(),name:s.data.name,slug:s.data.slug,description:s.data.description,image:s.data.image||"",status:s.data.status,subCategories:((a=s.data.sub_categories)==null?void 0:a.map(n=>({id:n.id.toString(),name:n.name,slug:n.slug,status:n.status,isNew:!1,isDeleted:!1})))||[]}),s.data.image&&$(ge(s.data.image)),j(!1);return}}catch{d.error("Failed to load category"),j(!1)}},D=(a,t)=>{if(!i&&(g(s=>({...s,[a]:t})),a==="name"&&!c)){const s=t.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-");g(n=>({...n,slug:s}))}},G=(a,t,s)=>{i||g(n=>({...n,subCategories:n.subCategories.map((o,v)=>{if(v===a){const u={...o,[t]:s};return t==="name"&&(!o.id||o.isNew)&&(u.slug=s.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-")),u}return o})}))},ee=a=>{i||g(t=>({...t,subCategories:t.subCategories.map((s,n)=>n===a?{...s,status:s.status==="active"?"inactive":"active"}:s)}))},q=()=>{if(i)return;const a={name:"",slug:"",status:"active",isNew:!0};g(t=>({...t,subCategories:[...t.subCategories,a]})),R(t=>{const s=new Set(t);return s.add(r.subCategories.length),s})},se=async a=>{var s,n;if(i)return;const t=r.subCategories[a];if(t.id&&!t.isNew)try{j(!0);const v=(await z.post("/remove-subcat/",{id:t.id})).data;v.error==!1?(d.success(`Subcategory "${t.name}" removed successfully`),g(u=>({...u,subCategories:u.subCategories.map((N,l)=>l===a?{...N,isDeleted:!0}:N)})),g(u=>({...u,subCategories:u.subCategories.filter((N,l)=>l!==a)}))):d.error(v.data||"Failed to remove subcategory")}catch(o){console.error("Error removing subcategory:",o),d.error(((n=(s=o.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to remove subcategory")}finally{j(!1)}else g(o=>({...o,subCategories:o.subCategories.filter((v,u)=>u!==a)}))},ae=a=>{R(t=>{const s=new Set(t);return s.has(a)?s.delete(a):s.add(a),s})},te=a=>{var n;if(i)return;const t=(n=a.target.files)==null?void 0:n[0];if(!t)return;if(!t.type.startsWith("image/")){d.error("Please upload an image file (JPEG, PNG, etc.)");return}if(t.size>5*1024*1024){d.error("Image must be less than 5MB");return}A(t);const s=URL.createObjectURL(t);$(s),g(o=>({...o,image:t.name})),d.info(`${t.name} has been selected`)},re=()=>{i||(A(null),$(""),g(a=>({...a,image:""})))},ie=()=>{for(let a=0;a<r.subCategories.length;a++){const t=r.subCategories[a];if(!t.name.trim())return d.error(`Subcategory #${a+1} name is required`),!1;if(!t.slug.trim())return d.error(`Subcategory #${a+1} slug is required`),!1}return!0},B=async()=>{var a,t;if(!r.name.trim()){d.error("Category name is required");return}if(!r.slug.trim()){d.error("Slug is required");return}if(!r.image&&!w&&!c){d.error("Please upload an image");return}if(ie()){j(!0);try{const s=new FormData;c&&s.append("id",r.id),s.append("name",r.name),s.append("slug",r.slug),s.append("description",r.description),s.append("status",r.status),y?s.append("image",y):r.image&&!y&&s.append("image",r.image);const n=r.subCategories.filter(l=>l.isNew&&!l.isDeleted).map(({name:l,slug:I,status:_})=>({name:l,slug:I,status:_})),o=r.subCategories.filter(l=>!l.isNew&&!l.isDeleted&&l.id).map(({id:l,name:I,slug:_,status:ce})=>({id:l,name:I,slug:_,status:ce}));s.append("new_subcategories",JSON.stringify(n)),s.append("existing_subcategories",JSON.stringify(o));const v=c?"/update-category/":"/save-category/",N=(await z.post(v,s,{headers:{"Content-Type":"multipart/form-data"}})).data;if(N.error==!1){d.success(`${r.name} has been successfully ${c?"updated":"created"}.`),x.startTransition(()=>h("/admin/categories"));return}d.error(N.data||"Operation failed")}catch(s){console.error("Error:",s),d.error(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||`Failed to ${c?"update":"create"} category`)}finally{j(!1)}}},ne=()=>{i||g(a=>({...a,status:a.status==="active"?"inactive":"active"}))};return C&&c?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"animate-pulse text-center",children:[e.jsx("div",{className:"h-6 w-48 bg-muted rounded mx-auto mb-4"}),e.jsx("div",{className:"h-4 w-32 bg-muted rounded mx-auto"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>h("/admin/categories"),className:"h-8 w-8",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-2xl md:text-3xl mb-1",children:f?`View Category: ${r.name||k}`:c?`Edit Category: ${r.name||k}`:"Create New Category"}),e.jsx("p",{className:"text-muted-foreground",children:f?"View category details":c?"Update category details and settings":"Add a new product category"})]})]}),!f&&e.jsxs(m,{onClick:B,disabled:C,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),C?"Saving...":c?"Update Category":"Create Category"]}),f&&e.jsxs(m,{onClick:()=>h(`/admin/categories/${b}/${k}`),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Edit Category"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(F,{children:[e.jsxs(E,{children:[e.jsx(P,{children:"Category Details"}),e.jsx(T,{children:"Enter the basic information for your category"})]}),e.jsx(U,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Category Name *"}),e.jsx(S,{id:"name",value:r.name,onChange:a=>D("name",a.target.value),placeholder:"e.g., Hair Extensions",disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"slug",children:"Slug *"}),e.jsx(S,{id:"slug",value:r.slug,onChange:a=>D("slug",a.target.value),placeholder:"e.g., hair-extensions",className:"font-mono",disabled:i}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["This will be used in URLs: /category/",r.slug||"your-slug"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",children:"Description"}),e.jsx(he,{id:"description",value:r.description,onChange:a=>D("description",a.target.value),placeholder:"Describe this category...",rows:4,disabled:i})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{htmlFor:"status",children:"Category Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:r.status==="active"?"Active":"Inactive"}),e.jsx(V,{id:"status",checked:r.status==="active",onCheckedChange:ne,disabled:i})]})]})})]})})]}),e.jsxs(F,{children:[e.jsxs(E,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Sub Categories"}),e.jsx(T,{children:"Add and manage subcategories under this category"})]}),!i&&e.jsxs(m,{onClick:q,size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Add Subcategory"]})]}),e.jsx(U,{className:"space-y-4",children:r.subCategories.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted-foreground/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(O,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"No subcategories added yet"}),!i&&e.jsxs(m,{variant:"outline",onClick:q,size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Add Your First Subcategory"]})]}):e.jsx("div",{className:"space-y-3",children:r.subCategories.map((a,t)=>e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-muted/30",children:[e.jsx(pe,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),e.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>ae(t),children:L.has(t)?e.jsx(fe,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:a.name||"New Subcategory"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Slug: ",a.slug||"not-set"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 mr-2",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${a.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.status})}),!i&&e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>se(t),className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(K,{className:"h-4 w-4"})})]})]}),L.has(t)&&e.jsxs("div",{className:"p-4 border-t space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subcategory Name *"}),e.jsx(S,{value:a.name,onChange:s=>G(t,"name",s.target.value),placeholder:"e.g., Clip-in Extensions",disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Slug *"}),e.jsx(S,{value:a.slug,onChange:s=>G(t,"slug",s.target.value),placeholder:"e.g., clip-in-extensions",className:"font-mono",disabled:i})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:a.status==="active"?"Active":"Inactive"}),e.jsx(V,{checked:a.status==="active",onCheckedChange:()=>ee(t),disabled:i})]})]})]})]},t))})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsxs(E,{children:[e.jsx(P,{children:"Category Image"}),e.jsx(T,{children:"Upload or change the category image"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden border bg-muted",children:w||r.image?e.jsxs("div",{className:"relative w-full h-full group",children:[e.jsx("img",{src:w||r.image,alt:"Category preview",className:"w-full h-full object-cover"}),!i&&e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:e.jsxs(m,{variant:"destructive",size:"sm",onClick:re,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Remove"]})})]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted-foreground/10 flex items-center justify-center mb-4",children:e.jsx(Q,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"No image uploaded"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: 800Ã—800px, PNG or JPG"})]})}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(S,{id:"image-upload",type:"file",accept:"image/*",onChange:te,className:"hidden"}),e.jsx(p,{htmlFor:"image-upload",className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 border-2 border-dashed border-border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:w||r.image?"Change Image":"Upload Image"})]})})]}),(w||r.image)&&e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Current Image:"}),e.jsx("p",{className:"text-muted-foreground break-all",children:y?y.name:r.image.split("/").pop()}),y&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Size: ",(y.size/1024).toFixed(2)," KB"]})]})]})]}),!f&&e.jsxs(F,{children:[e.jsx(E,{children:e.jsx(P,{children:"Quick Actions"})}),e.jsxs(U,{className:"space-y-3",children:[e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>h("/admin/categories"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Back to Categories"]}),c&&e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>h(`/admin/categories/${b}/${k}?view=true`),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"View Category"]}),e.jsxs(m,{variant:"destructive",className:"w-full justify-start",onClick:()=>{window.confirm("Are you sure you want to discard changes?")&&h("/admin/categories")},children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Discard Changes"]})]})]})]})]}),!f&&e.jsx("div",{className:"sticky bottom-0 bg-background border-t py-4",children:e.jsxs("div",{className:"container flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:c?"Update this category":"Create a new category"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{variant:"outline",onClick:()=>h("/admin/categories"),children:"Cancel"}),e.jsx(m,{onClick:B,disabled:C,className:"min-w-[140px]",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent mr-2"}),c?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),c?"Update Category":"Create Category"]})})]})]})})]})};export{_e as default};
