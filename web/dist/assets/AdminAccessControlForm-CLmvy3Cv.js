import{F as ge,aN as je,E as fe,r as o,j as e,B as h,v as G,N as f,x as _,X as J,J as X,u as Ne,m as q,w as K,h as E,a6 as m,S as ve,P as ye,M as we,be as Ce}from"./index-DrzvgQSx.js";import{C as p,a as D,b as k,c as F,d as u}from"./card-CSdj4VlM.js";import{P as W}from"./progress-DNf4bHVP.js";import{T as be}from"./textarea-svmRLyU5.js";import{S as Se}from"./switch-BNZbPRLI.js";import{L as I}from"./label-D6nqg-AK.js";import{S as Y,a as Z,b as ee,c as se,d as L}from"./select-CeCrIOLN.js";import{S as Ae}from"./separator-DpYAwveS.js";import{A as Pe,a as De,b as ke,c as Fe,d as Re,e as Te,f as _e,g as Ee,h as Ie}from"./alert-dialog-DhLhMJxG.js";import{A as Le}from"./arrow-left-4JsjAwAx.js";import{T as Me}from"./trash-2-DF_8SWob.js";import{S as ae}from"./save-BctxvPZE.js";import{P as re}from"./plus-CdXz1Jo6.js";import{C as ze}from"./circle-check-big-Cc93Cm_Q.js";import{F as Be}from"./filter-D38QoaQC.js";import{T as Ve}from"./trending-up-BqcXVX7P.js";import{C as Ue}from"./credit-card-B1BYDSKm.js";import{P as Qe}from"./percent-DSP3Ckz8.js";import{F as $e}from"./folder-CcLGYOr-.js";import{B as He}from"./box-LvK4p4yP.js";import{U as te}from"./users-BACZCDYD.js";import"./index-DDpYfoMH.js";import"./index-BdQq_4o_.js";import"./chevron-up-DEDQgLDp.js";const le={Analytics:Ve,"Cashier/Pos":Ue,Orders:ve,Discount:Qe,Products:ye,Categories:$e,Inventory:He,Customers:te,Staff:te,"Pickup Location":we,"Roles (Access Control)":f,Settings:Ce},gs=()=>{const N=ge(),{add_role:M,delete_role:z,edit_role:ie,view_roles:Oe}=je(["add_role","delete_role","edit_role","view_roles"]),{id:C}=fe(),x=!!C,l=window.location.search.includes("view=true"),[c,g]=o.useState({name:"",description:"",permissions:[]}),[S,B]=o.useState(""),[v,V]=o.useState("all"),[b,U]=o.useState(""),[ne,Q]=o.useState(!1),[y,A]=o.useState(!1),[R,$]=o.useState(!1),[n,ce]=o.useState([]),w=o.useMemo(()=>[...new Set(n.map(s=>s.category))].sort(),[n]),j=o.useMemo(()=>{const s=n.length,a=c.permissions.length,r=s>0?a/s*100:0,t=w.map(i=>{const d=n.filter(T=>T.category===i),P=d.filter(T=>c.permissions.includes(T.code)).length,ue=d.length>0?P/d.length*100:0;return{name:i,total:d.length,selected:P,percentage:ue}});return{totalPermissions:s,selectedCount:a,coveragePercentage:r,categoryStats:t,isEmpty:a===0}},[c.permissions,n,w]);o.useEffect(()=>{(async()=>{try{$(!0);const r=(await E.get("/get-roles/")).data;if(!r.error&&r.data){const t=r.data.map(i=>({id:i.id.toString(),code:i.code,name:i.name,description:i.description,icon:f,category:i.category}));ce(t)}else m.error("Failed to load permissions")}catch(a){console.error("Error fetching permissions:",a),m.error("Failed to load permissions")}finally{$(!1)}})()},[]),o.useEffect(()=>{if(x){if(!ie){o.startTransition(()=>N("/unauthorized"));return}(async()=>{try{A(!0);const r=(await E.get(`/get-permissions/${C}/`)).data;!r.error&&r.data&&g({name:r.data.name||"",description:r.data.description||"",permissions:r.data.permissions||[]})}catch(a){console.error("Error fetching role:",a),m.error("Failed to load role data")}finally{A(!1)}})()}else if(!M){o.startTransition(()=>N("/unauthorized"));return}},[C,x]);const oe=o.useMemo(()=>n.filter(s=>{const a=s.name.toLowerCase().includes(S.toLowerCase())||s.description.toLowerCase().includes(S.toLowerCase()),r=v==="all"||s.category===v;return a&&r}),[S,v,n]),de=s=>{l||g(a=>{const r=a.permissions.includes(s)?a.permissions.filter(t=>t!==s):[...a.permissions,s];return{...a,permissions:r}})},H=s=>{if(l)return;const a=n.filter(t=>t.category===s).map(t=>t.code),r=a.every(t=>c.permissions.includes(t));g(t=>({...t,permissions:r?t.permissions.filter(i=>!a.includes(i)):[...new Set([...t.permissions,...a])]}))},me=()=>{l||(g(s=>({...s,permissions:n.map(a=>a.code)})),m.success("All permissions selected"))},xe=()=>{l||(g(s=>({...s,permissions:[]})),m.success("All permissions cleared"))},he=()=>{if(!b||l)return;const s=n.filter(a=>a.category===b).map(a=>a.code);g(a=>({...a,permissions:[...new Set([...a.permissions,...s])]})),U(""),m.success(`Added all ${b} permissions`)},O=async()=>{var s,a;if(M){if(!c.name.trim()){m.error("Please enter a role name");return}if(!c.description.trim()){m.error("Please enter a role description");return}if(c.permissions.length===0){m.error("Please select at least one permission");return}try{A(!0);const r={name:c.name,description:c.description,permissions:c.permissions};x&&(r.id=C);const t=x?"/update-role/":"/save-role/",d=(await E.post(t,r)).data;if(!d.error&&d.data){const P=x?"updated":"created";m.success(`Role ${P} successfully`),N("/admin/access-control")}else m.error(d.data||"Failed to save role")}catch(r){console.error("Error saving role:",r),m.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.data)||r.message||"Failed to save role")}finally{A(!1)}}},pe=()=>{z&&(m.success(`Access level "${c.name}" deleted successfully`),Q(!1),o.startTransition(()=>N("/admin/access-control")))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>o.startTransition(()=>N("/admin/access-control")),className:"hover:bg-muted",children:e.jsx(Le,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-2xl md:text-3xl mb-2",children:l?"View Access Role":x?"Edit Access Role":"Create Access Role"}),e.jsx("p",{className:"text-muted-foreground",children:l?"View role details and permissions":x?"Modify permissions for this access role":"Create a new access role with specific permissions"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[x&&!l&&z&&e.jsxs(Pe,{open:ne,onOpenChange:Q,children:[e.jsx(De,{asChild:!0,children:e.jsxs(h,{variant:"destructive",className:"gap-2",children:[e.jsx(Me,{className:"h-4 w-4"}),"Delete"]})}),e.jsxs(ke,{children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:"Delete Access Role"}),e.jsxs(Te,{children:['Are you sure you want to delete "',c.name,'"? This action cannot be undone. Any staff members assigned this role will lose their permissions.']})]}),e.jsxs(_e,{children:[e.jsx(Ee,{children:"Cancel"}),e.jsx(Ie,{onClick:pe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Role"})]})]})]}),!l&&e.jsxs(h,{onClick:O,className:"gap-2",disabled:y,children:[e.jsx(ae,{className:"h-4 w-4"}),y?"Saving...":x?"Update Role":"Create Role"]})]})]}),(y||R)&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:R?"Loading permissions...":"Loading role data..."})]}),!y&&!R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsxs(D,{children:[e.jsx(k,{children:"Role Details"}),e.jsx(F,{children:l?"View role information":"Define the basic information for this role"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{htmlFor:"name",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(G,{id:"name",placeholder:"e.g., Sales Manager, Inventory Staff",value:c.name,onChange:s=>!l&&g(a=>({...a,name:s.target.value})),disabled:l,className:"text-lg font-medium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{htmlFor:"description",children:["Description ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(be,{id:"description",placeholder:"Describe the purpose and responsibilities of this role...",value:c.description,onChange:s=>!l&&g(a=>({...a,description:s.target.value})),disabled:l,rows:4})]}),x&&e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Role ID"}),e.jsx("code",{className:"text-xs px-2 py-1 bg-background rounded",children:C})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"This ID is used internally and cannot be changed"})]})]})]}),e.jsxs(p,{children:[e.jsxs(D,{children:[e.jsx(k,{children:"Permissions Analytics"}),e.jsx(F,{children:"Summary of selected permissions"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Selected"}),e.jsx("p",{className:"text-2xl font-bold",children:j.selectedCount})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Coverage"}),e.jsxs("p",{className:"text-2xl font-bold",children:[j.coveragePercentage.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overall Coverage"}),e.jsxs("span",{className:"text-sm font-medium",children:[j.selectedCount,"/",j.totalPermissions]})]}),e.jsx(W,{value:j.coveragePercentage,className:"h-2"})]}),e.jsx(Ae,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Category Breakdown"}),j.categoryStats.map(s=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.name})]}),e.jsxs("span",{className:"text-sm font-medium",children:[s.selected,"/",s.total]})]}),e.jsx(W,{value:s.percentage,className:"h-1.5"})]},s.name))]})]})]}),!l&&e.jsxs(p,{children:[e.jsxs(D,{children:[e.jsx(k,{children:"Quick Actions"}),e.jsx(F,{children:"Quickly manage permissions"})]}),e.jsxs(u,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:me,disabled:n.length===0,className:"gap-2",children:[e.jsx(_,{className:"h-3 w-3"}),"Select All"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:xe,className:"gap-2",children:[e.jsx(J,{className:"h-3 w-3"}),"Clear All"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-sm",children:"Add Entire Category"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{value:b,onValueChange:U,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Select category"})}),e.jsx(se,{children:w.map(s=>e.jsx(L,{value:s,children:s},s))})]}),e.jsx(h,{size:"icon",onClick:he,disabled:!b||n.length===0,children:e.jsx(re,{className:"h-4 w-4"})})]})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(p,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-1",children:"Permissions Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l?"View all permissions assigned to this role":"Select the permissions for this access role"})]}),!l&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(X,{variant:"outline",className:"gap-1",children:[e.jsx(ze,{className:"h-3 w-3"}),j.selectedCount," selected"]})})]})})}),e.jsx(p,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search permissions by name or description...",value:S,onChange:s=>B(s.target.value),className:"pl-9",disabled:l||n.length===0})]}),e.jsxs(Y,{value:v,onValueChange:V,disabled:n.length===0,children:[e.jsxs(Z,{className:"w-[180px]",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),e.jsx(ee,{placeholder:"All Categories"})]}),e.jsxs(se,{children:[e.jsx(L,{value:"all",children:"All Categories"}),w.map(s=>e.jsx(L,{value:s,children:s},s))]})]})]})})}),!l&&n.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(s=>{const a=n.filter(t=>t.category===s).every(t=>c.permissions.includes(t.code)),r=le[s]||f;return e.jsxs(h,{variant:a?"default":"outline",size:"sm",onClick:()=>H(s),className:"gap-2",children:[a?e.jsx(_,{className:"h-3 w-3"}):e.jsx(re,{className:"h-3 w-3"}),e.jsx(r,{className:"h-3 w-3"}),s]},s)})}),e.jsx("div",{className:"space-y-6",children:w.map(s=>{const a=n.filter(i=>i.category===s),r=a.filter(i=>c.permissions.includes(i.code)),t=le[s]||f;return v!=="all"&&v!==s?null:e.jsxs(p,{className:"overflow-hidden",children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:e.jsx(t,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx(k,{className:"text-lg",children:s}),e.jsxs(F,{children:[r.length," of ",a.length," permissions selected"]})]})]}),!l&&e.jsx(h,{variant:"outline",size:"sm",onClick:()=>H(s),className:"gap-2",children:a.every(i=>c.permissions.includes(i.code))?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3 w-3"}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-3 w-3"}),"Select All"]})})]})}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.map(i=>{const d=c.permissions.includes(i.code);return e.jsx(q.div,{whileHover:{y:-2},transition:{duration:.2},children:e.jsx("div",{className:K("p-3 rounded-lg border transition-all duration-200",d?"border-primary/50 bg-primary/5":"border-border hover:border-muted-foreground/30",!l&&"cursor-pointer"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:K("p-2 rounded-md flex-shrink-0",d?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(t,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.description})]}),l?e.jsx(X,{variant:d?"default":"outline",className:"ml-2 text-xs",children:d?"Granted":"Denied"}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Se,{checked:d,onCheckedChange:()=>de(i.code),className:"ml-2"})})]})})]})})},i.id)})})})]},s)})}),oe.length===0&&n.length>0&&e.jsx(p,{children:e.jsxs(u,{className:"py-12 text-center",children:[e.jsx(f,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No permissions found matching your search"}),e.jsx(h,{variant:"outline",className:"mt-4",onClick:()=>{B(""),V("all")},children:"Clear Filters"})]})}),n.length===0&&e.jsx(p,{children:e.jsxs(u,{className:"py-12 text-center",children:[e.jsx(f,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No permissions available"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Permissions will appear here once they are loaded from the server"})]})})]})]}),!l&&e.jsx(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"sticky bottom-6 z-10",children:e.jsx(p,{className:"shadow-xl border-primary/20",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:e.jsx(f,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:c.name||"New Access Role"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[j.selectedCount," permissions selected"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>N("/admin/access-control"),children:"Cancel"}),e.jsxs(h,{onClick:O,size:"lg",className:"gap-2",disabled:y||n.length===0,children:[e.jsx(ae,{className:"h-4 w-4"}),y?"Saving...":x?"Update Role":"Create Role"]})]})]})})})})]})]})};export{gs as default};
