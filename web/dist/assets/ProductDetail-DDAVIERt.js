import{r as c,U as re,E as le,F as ne,a0 as ce,j as e,o as Q,q as p,B as x,L as w,m as B,J as b,C as oe,a as de,H as j,w as D,x as U,S as me,O as he,h as K,a1 as m,d as R,a2 as xe}from"./index-DrzvgQSx.js";import{M as ue}from"./minus-BZn02uM1.js";import{P as ge}from"./plus-CdXz1Jo6.js";import{S as pe}from"./store-Cjxw61W-.js";import{L as fe}from"./loader-circle-oXQTLidO.js";import{S as je}from"./share-2-B_QQVOZf.js";import{T as ye}from"./truck-Bjx6mnMk.js";const Ce=()=>{const{auth:G}=c.useContext(re),{id:k}=le(),S=ne(),[$,C]=c.useState(0),[y,E]=c.useState(1),[h,M]=c.useState({}),[ve,F]=c.useState([]),{addToCart:L}=ce(),[s,O]=c.useState(null),[J,P]=c.useState(!0),[q,z]=c.useState(!1),[_,V]=c.useState(!1),[f,I]=c.useState(0),X=(t,a)=>{if(!(s!=null&&s.variants)||!a||Object.keys(a).length===0)return t;let l=t;const n=[];return s.variants.forEach(i=>{var o;if(i.type&&a[i.type]){const v=a[i.type],N=(o=i.options)==null?void 0:o.find(g=>g.value===v);if(N){const g=parseFloat(N.price_modifier||"0");l+=g,n.push({type:i.type,value:N.value,priceModifier:g})}}}),F(n),l};c.useEffect(()=>{if(s){const t=X(s.price,h);I(t)}},[h,s]);const Y=t=>{var H;const a=t.gallery.length>0?R(t.gallery[0].image):"/placeholder.jpg",l=t.gallery.map(r=>R(r.image)),n=t.features.sort((r,d)=>r.sort_order-d.sort_order).map(r=>r.feature),i=((H=t.variants)==null?void 0:H.map(r=>({type:r.type,options:r.options.map(d=>({value:d.value,price_modifier:d.price_modifier}))})))||[],o={},v=[];i.length>0&&i.forEach(r=>{if(r.options&&r.options.length>0){const d=r.options[0];o[r.type]=d.value;const ie=parseFloat(d.price_modifier||"0");v.push({type:r.type,value:d.value,priceModifier:ie})}}),M(o),F(v);const N=i.every(r=>o[r.type]!==void 0);V(N);const g=parseFloat(t.price),ae=g+v.reduce((r,d)=>r+d.priceModifier,0);return I(ae),{id:t.id.toString(),name:t.name,slug:xe(t.name),category_id:t.category_id,category_slug:t.category_slug,category:t.category_name,description:t.description,price:g,originalPrice:t.original_price?parseFloat(t.original_price):null,image:a,gallery:l,features:n,isNew:t.is_new===1,isBestSeller:t.is_best_seller===1,inStock:t.in_stock===1,is_wishlist:t.is_wishlist?"1":"0",createdAt:t.created_at,weight:t.weight,item_width:t.item_width,item_height:t.item_height,item_depth:t.item_depth,stockQuantity:t.stock_quantity,lowStockAlert:t.low_stock_alert,sku:t.sku,variants:i}};c.useEffect(()=>{if(s!=null&&s.variants&&s.variants.length>0){const t=s.variants.every(a=>h[a.type]!==void 0&&h[a.type]!=="");V(t)}else V(!0)},[h,s]);const Z=async t=>{var a,l;if(t.preventDefault(),t.stopPropagation(),!!s)try{z(!0);const i=(await K.post("/toggle-wishlist/",{id:s.id,auth:G?"1":"0"})).data;i.error?m.error(i.data||"Failed to update wishlist"):(O(o=>o?{...o,is_wishlist:o.is_wishlist==="1"?"0":"1"}:null),((a=i.data)==null?void 0:a.action)==="added"?m.success(`${s.name} has been added to your wishlist.`):((l=i.data)==null?void 0:l.action)==="removed"&&m.success(`${s.name} has been removed from your wishlist.`))}catch(n){console.error("Error toggling wishlist:",n),m.error("Failed to update wishlist")}finally{z(!1)}},ee=()=>{if(!s)return;if(s.variants&&s.variants.length>0&&!_){m.error("Please select all available variants before adding to cart");return}const t=s.variants&&s.variants.length>0;L(s,y,h,t)&&m.success(`${s.name} added to cart`)},se=()=>{if(!s)return;if(s.variants&&s.variants.length>0&&!_){m.error("Please select all available variants before adding to cart");return}const t=s.variants&&s.variants.length>0;L(s,y,h,t)&&S("/checkout")},te=(t,a,l)=>{M(n=>({...n,[t]:a})),F(n=>{const i=n.filter(o=>o.type!==t);return i.push({type:t,value:a,priceModifier:l}),i})};if(c.useEffect(()=>{(async()=>{if(k)try{P(!0);const l=(await K.get(`/get-product/${k}/`)).data;if(!l.error&&l.data){const n=l.data,i=Y(n);O(i)}else m.error(l.data||"Product not found"),S("/shop")}catch(a){console.error("Error fetching product:",a),m.error("Failed to load product")}finally{P(!1)}})()},[k,S]),J)return e.jsx(Q,{children:e.jsx("div",{className:"container py-20",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 lg:gap-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-square rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"flex gap-3",children:[1,2,3].map(t=>e.jsx("div",{className:"w-20 h-20 rounded-lg bg-muted animate-pulse"},`${t}-${p()}`))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-4 w-32 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-8 w-64 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-6 w-32 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse"},`${t}-${p()}`))})]})]})})});if(!s)return e.jsx(Q,{children:e.jsxs("div",{className:"container py-20 text-center",children:[e.jsx("h1",{className:"text-2xl font-medium mb-4",children:"Product not found"}),e.jsx(x,{asChild:!0,children:e.jsx(w,{to:"/shop",children:"Back to Shop"})})]})});const u=s.gallery&&s.gallery.length>0?s.gallery:[s.image,s.image,s.image],W=s.originalPrice&&s.originalPrice>f,T=W&&s.originalPrice?Math.round((s.originalPrice-f)/s.originalPrice*100):0,A=!s.inStock||s.variants&&s.variants.length>0&&!_;return e.jsx(Q,{children:e.jsx("section",{className:"py-8 md:py-12",children:e.jsxs("div",{className:"container",children:[e.jsxs("nav",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-8",children:[e.jsx(w,{to:"/",className:"hover:text-primary transition-colors",children:"Home"}),e.jsx("span",{children:"/"}),e.jsx(w,{to:"/shop",className:"hover:text-primary transition-colors",children:"Shop"}),e.jsx("span",{children:"/"}),e.jsx(w,{to:`/shop/${s.category_id}/${s.category_slug}`,className:"hover:text-primary transition-colors",children:s.category}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-foreground truncate",children:s.name})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 lg:gap-12",children:[e.jsxs(B.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},className:"space-y-4",children:[e.jsxs("div",{className:"relative aspect-square rounded-2xl overflow-hidden bg-muted",children:[e.jsx(B.img,{src:u[$],alt:s.name,className:"h-full w-full object-cover",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3}},`${$}-${p()}`),e.jsxs("div",{className:"absolute top-4 left-4 flex flex-col gap-2",children:[s.isNew&&e.jsx(b,{className:"bg-primary text-primary-foreground",children:"New"}),s.isBestSeller&&e.jsx(b,{className:"bg-orange-500 text-white",children:"Best Seller"}),W&&T>0&&e.jsxs(b,{className:"bg-red-500 text-white",children:["-",T,"%"]})]}),u.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"secondary",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 shadow-lg",onClick:()=>C(t=>(t-1+u.length)%u.length),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(x,{variant:"secondary",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 shadow-lg",onClick:()=>C(t=>(t+1)%u.length),children:e.jsx(de,{className:"h-4 w-4"})})]})]}),u.length>1&&e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2",children:u.map((t,a)=>e.jsx("button",{onClick:()=>C(a),className:`relative flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-colors ${$===a?"border-primary":"border-transparent"}`,children:e.jsx("img",{src:t,alt:`${s.name} - view ${a+1}`,className:"h-full w-full object-cover"})},`${a}-${p()}`))})]}),e.jsxs(B.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wider mb-2",children:s.category}),e.jsx("h1",{className:"font-display text-3xl md:text-4xl mb-4",children:s.name}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"font-display text-3xl text-primary",children:j(f)}),s.originalPrice&&s.originalPrice>f&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xl text-muted-foreground line-through",children:j(s.originalPrice)}),e.jsxs(b,{variant:"outline",className:"text-red-500 border-red-200",children:["Save ",j(s.originalPrice-f)]})]}),s.variants&&s.variants.length>0&&f!==s.price&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(Base: ",j(s.price),")"]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(b,{variant:"outline",className:"text-sm font-normal",children:["SKU: ",s.sku]}),s.stockQuantity&&s.stockQuantity>0&&e.jsx("span",{className:D("text-sm",s.lowStockAlert&&s.stockQuantity<=s.lowStockAlert?"text-orange-600":"text-green-600"),children:s.lowStockAlert&&s.stockQuantity<=s.lowStockAlert?`Low stock: ${s.stockQuantity} units`:`${s.stockQuantity} units available`})]}),e.jsx("p",{className:"text-muted-foreground leading-relaxed whitespace-pre-line",children:s.description})]}),s.variants&&s.variants.length>0&&e.jsx("div",{className:"space-y-4",children:s.variants.map(t=>e.jsxs("div",{children:[e.jsx("label",{className:"font-medium mb-3 block",children:t.type}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.options&&t.options.map(a=>e.jsxs("button",{onClick:()=>te(t.type,a.value,parseFloat(a.price_modifier||"0")),className:`px-4 py-2 rounded-lg border text-sm font-medium transition-colors flex items-center gap-2 ${h[t.type]===a.value?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50"}`,children:[a.value,a.price_modifier&&e.jsx("span",{className:"text-xs opacity-75",children:parseFloat(a.price_modifier)>0?`+${j(parseFloat(a.price_modifier))}`:j(parseFloat(a.price_modifier))})]},`${a.value}-${p()}`))})]},`${t.type}-${p()}`))}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium mb-3 block",children:"Quantity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center border rounded-lg",children:[e.jsx("button",{onClick:()=>E(t=>Math.max(1,t-1)),className:"p-3 hover:bg-muted transition-colors disabled:opacity-50",disabled:y<=1,children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-12 text-center font-medium",children:y}),e.jsx("button",{onClick:()=>E(t=>t+1),className:"p-3 hover:bg-muted transition-colors disabled:opacity-50",disabled:s.stockQuantity&&s.stockQuantity>0&&y>=s.stockQuantity,children:e.jsx(ge,{className:"h-4 w-4"})})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.inStock?e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(U,{className:"h-4 w-4"})," In Stock"]}):e.jsx("span",{className:"text-red-600",children:"Out of Stock"})})]})]}),s.variants&&s.variants.length>0&&!_&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"Please select all available variants before adding to cart"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(x,{size:"lg",className:"flex-1",onClick:ee,disabled:A,children:[e.jsx(me,{className:"h-5 w-5 mr-2"}),A?"Select Options":"Add to Cart"]}),e.jsx(x,{size:"lg",variant:"secondary",className:"flex-1",onClick:se,disabled:A,children:"Buy Now"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(x,{size:"lg",variant:"outline",className:"flex-1",asChild:!0,children:e.jsxs(w,{to:"/contact",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"View In-Store"]})})}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:Z,disabled:q,className:D(s.is_wishlist==="1"&&"text-primary"),children:[q?e.jsx(fe,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(he,{className:D("h-4 w-4 mr-2",s.is_wishlist==="1"&&"fill-current")}),s.is_wishlist==="1"?"In Wishlist":"Add to Wishlist"]}),e.jsxs(x,{variant:"ghost",size:"sm",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Share"]})]}),s.features&&s.features.length>0&&e.jsxs("div",{className:"pt-6 border-t",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Product Features"}),e.jsx("ul",{className:"space-y-2",children:s.features.map((t,a)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm text-muted-foreground",children:[e.jsx(U,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),e.jsx("span",{children:t})]},`${a}-${p()}`))})]}),e.jsxs("div",{className:"space-y-4 pt-6 border-t",children:[s.weight&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Weight"}),e.jsxs("span",{className:"font-medium",children:[s.weight," KG"]})]}),s.item_height&&s.item_width&&s.item_depth&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Dimensions"}),e.jsxs("span",{className:"font-medium",children:[s.item_height,"CM x ",s.item_width,"CM x ",s.item_depth,"CM"]})]})]}),e.jsx("div",{className:"p-4 bg-muted rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Free Shipping on Orders Over $100"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivery within 3-7 business days in Alberta"})]})]})})]})]})]})})})};export{Ce as default};
